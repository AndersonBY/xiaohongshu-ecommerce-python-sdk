# 应用消息推送

**文档ID**: 41
**类别**: 开发文档
**创建时间**: 2023-09-19 15:08:45
**更新时间**: 2024-07-08 15:49:02

---

## 应用消息推送指南

### 概述

消息推送取代轮询API的方式，可提升数据传输效率。本页面介绍如何使用OpenAPI消息推送功能， 当前支持包括商品、订单、售后关键业务节点的消息推送。

### 一、消息类型（2022年5月25日更新）

#### 1、订单消息

| 消息事件名称 | msgTag | 触发场景 |
| --- | --- | --- |
| 订单状态变更 | msg\_fulfillment\_status\_change | 用户下单 用户支付后，订单触发风控 支付后，跨境商品清关 用户支付后，订单走完风控，等待操作 卖家对部分商品发货 卖家对全部商品发货 买家确认收货或系统自动确认收货，且母订单状态变为「已完成」 售后完成，订单关闭 |
| 买家收货信息变更 | msg\_fulfillment\_receiver\_change | 收货信息被商家修改 收货信息被买家修改 收货信息被平台客服修改 |
| 卖家修改备注 | msg\_fulfillment\_seller\_remark\_change | 卖家修改交易备注 |
| 订单发货时效变更 | msg\_fulfillment\_delivery\_time\_change | 商家创建报备单，向平台提交影响发货时效的申请 |

#### 2、商品消息

| 消息事件名称 | msgTag | 触发场景 |
| --- | --- | --- |
| 商品新建 | msg\_item\_create | 商品新建 |
| 商品上下架 | msg\_item\_buyable | 商品上架 商品下架 |
| 商品审核驳回 | msg\_item\_audit\_reject | 商品状态已驳回 |

#### 3、售后消息

| 消息事件名称 | msgTag | 触发场景 |
| --- | --- | --- |
| 发起售后申请 | msg\_after\_sale\_create | 订单未发货，申请仅退款 订单已发货，申请仅退款 订单已发货，申请退款退货 订单已发货，申请换货 |
| 售后类型变更 | msg\_after\_sale\_transfer | 卖家/平台客服修改售后单 |

### 二、消息类型（2024年11月15日更新）

1、进入小红书开放平台控制台，进入相关应用的应用管理界面（满足下列条件，才会推送）

* 开启推送服务开关，表示接受已订阅的消息推送
* 点击修改推送地址（注意带上https://或http://），可将已订阅的相关消息推送到该地址。目前一个应用仅支持配置一个地址
* 推送地址填写完毕后，返回状态检测结果。为保证消息推送正常，请确保推送地址的检测状态为**正常**
* 推送地址请保证post请求返回httpcode=200，测试推送post数据：{“test”:true}
* 推送时请保证拥有对应的店铺授权且accessToken在有效期内
* 在消息列表中，选择需要订阅的消息类型

![](https://picasso-static.xiaohongshu.com/fe-platform/6143da77e097b64152d85e8375be5a4065f6edd1.png)

### 消息生成

消息由业务方事件触发，开放平台接收消息之后，对消息进行处理，然后通过HTTP方式发送给应用  
必须在应用管理中配置消息回调地址，应用使用同一个回调地址接收消息，根据消息中的消息类型区分不同业务场景

#### 加签

##### 1.对除sign外的系统参数和所有请求参数进行排序

将url的所有**请求参数**以及除sign外的**系统参数**按照**字母**进行排序（如果参数包含中文，中文保持原文即可，无需对其单独转码），并使用&连接， 请求body不参与排序。见如下示例：

```
请求url为：
/open_api/msg?canshu=test
系统参数有:
timestamp: 1625475843
app-key: xhs

则参与排序的参数如下：
timestamp=1625475843
app-key=xhs
排序连接后的结果为 app-key=xhs&tamp=1625475843

拼接 url+参数+app-secret
假设app-secret=9a539709cafc1efc9ef05838be468a28
拼接之后的结果为 /open_api/msg?app-key=xhs&tamp=16254758439a539709cafc1efc9ef05838be468a28

MD5计算签名
上述字符串的MD5签名结果为 a7b7430de338783293443133ab9b9357

Header中数据:
timestamp: 1625475843
app-key: xhs
sign: a7b7430de338783293443133ab9b9357
```

#### POST数据

消息data具体内容参见消息文档

```
[
    {
       msgTag: string   // 消息类型
       sellerId: string // 商家店铺Id
       data: string     // 消息内容
    }
]
```

#### 要返回给平台的数据结构

```
{
   success: bool      // true/false
   error_code: int    // 错误代码
   error_msg: string  // 错误描述
}
```

### 消息重试

现阶段消息推送重试已上线。应用满足推送条件后，平台会发起正常推送流程，若首次推送失败，后续会重试1次。在前一次失败的5m后推送。

**注意：**服务商反馈消息丢失绝大多数由于对应店铺AT过期，请各服务商对接消息推送后务必保证AT在有效期内！